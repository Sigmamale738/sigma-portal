<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Project Ebooks - Open to Anyone</title>
  <meta name="google-adsense-account" content="ca-pub-5569376681314000">

  <style>
    *{margin:0;padding:0;box-sizing:border-box;font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;}
    body{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);
         display:flex;justify-content:center;align-items:center;min-height:100vh;padding:20px;}
    .container{display:flex;width:100%;max-width:900px;background:white;border-radius:15px;
               box-shadow:0 15px 35px rgba(0,0,0,0.1);overflow:hidden;}
    .welcome-section{flex:1;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);
                     color:white;padding:50px;display:flex;flex-direction:column;justify-content:center;}
    .welcome-section h1{font-size:2.5em;margin-bottom:20px;}
    .welcome-section p{font-size:1.1em;opacity:.9;line-height:1.6;}
    .form-section{flex:1;padding:50px;}
    .form-toggle{display:flex;margin-bottom:30px;border-bottom:2px solid #eee;}
    .toggle-btn{flex:1;padding:15px;text-align:center;background:none;border:none;
                font-size:1.1em;font-weight:600;color:#666;cursor:pointer;transition:.3s;}
    .toggle-btn.active{color:#667eea;border-bottom:3px solid #667eea;margin-bottom:-2px;}
    .form{display:none;}
    .form.active{display:block;}
    .form-group{margin-bottom:20px;}
    .form-group label{display:block;margin-bottom:8px;font-weight:600;color:#333;}
    .form-group input{width:100%;padding:15px;border:2px solid #e1e1e1;border-radius:8px;font-size:1em;
                      transition:border-color .3s;}
    .form-group input:focus{outline:none;border-color:#667eea;}
    .submit-btn{width:100%;padding:15px;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);
                color:white;border:none;border-radius:8px;font-size:1.1em;font-weight:600;
                cursor:pointer;transition:transform .2s;}
    .submit-btn:hover{transform:translateY(-2px);}
    .message{margin-top:15px;padding:10px;border-radius:5px;text-align:center;display:none;}
    .success{background:#d4edda;color:#155724;border:1px solid #c3e6cb;}
    .error{background:#f8d7da;color:#721c24;border:1px solid #f5c6cb;}
    .otp-section{display:none;}
    .otp-input{text-align:center;font-size:1.2em;letter-spacing:8px;font-weight:bold;}
    .resend-btn{background:#28a745!important;margin-top:10px;}
    .loading{opacity:.6;pointer-events:none;}
    .admin-indicator{position:fixed;top:10px;right:10px;background:#ffc107;color:#856404;
                     padding:8px 12px;border-radius:4px;font-size:.8em;display:none;}
  </style>
</head>

<body>
  <div class="admin-indicator" id="adminIndicator">üîí Admin Mode Active</div>

  <div class="container">
    <div class="welcome-section">
      <h1>Project Ebooks</h1>
      <p>True Cloud Database ‚Äî Login from any device</p>
    </div>

    <div class="form-section">
      <div class="form-container">
        <div class="form-toggle">
          <button class="toggle-btn" onclick="showForm('login')">Login</button>
          <button class="toggle-btn active" onclick="showForm('signup')">Sign Up</button>
        </div>

        <!-- Login Form -->
        <form id="loginForm" class="form">
          <div class="form-group">
            <label for="loginUsername">Username</label>
            <input type="text" id="loginUsername" required>
          </div>
          <div class="form-group">
            <label for="loginPassword">Password</label>
            <input type="password" id="loginPassword" required>
          </div>
          <button type="button" class="submit-btn" onclick="loginUser()">Login to Project Ebooks</button>
          <div id="loginMessage" class="message"></div>
        </form>

        <!-- Signup Form -->
        <form id="signupForm" class="form active">
          <div class="form-group">
            <label for="signupUsername">Choose Username</label>
            <input type="text" id="signupUsername" required>
          </div>
          <div class="form-group">
            <label for="signupEmail">Your Email</label>
            <input type="email" id="signupEmail" required>
          </div>
          <div class="form-group">
            <label for="signupPassword">Create Password</label>
            <input type="password" id="signupPassword" required minlength="6">
          </div>

          <!-- OTP -->
          <div id="otpSection" class="otp-section">
            <div class="form-group">
              <label for="otpCode">Enter OTP</label>
              <input type="text" id="otpCode" class="otp-input" maxlength="6"
                     placeholder="000000" oninput="validateOTP(this)">
            </div>
            <button type="button" class="submit-btn" onclick="verifyOTP()">Verify OTP & Register</button>
            <button type="button" class="submit-btn resend-btn" onclick="resendOTP()">Resend OTP</button>
          </div>

          <button type="button" class="submit-btn" onclick="sendOTP()" id="sendOtpBtn">Send OTP to Email</button>
          <div id="signupMessage" class="message"></div>
        </form>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
  <script>
    emailjs.init("6xeycUj5CInWKYKTr");

    let currentEmail='',currentUsername='',currentOTP='';
    const ADMIN_USERNAME="Sigma",ADMIN_PASSWORD="RASHIM0789";

    function showForm(formType){
      document.querySelectorAll('.toggle-btn').forEach(b=>b.classList.remove('active'));
      event.target.classList.add('active');
      document.querySelectorAll('.form').forEach(f=>f.classList.remove('active'));
      document.getElementById(formType+'Form').classList.add('active');
    }

    function showMessage(id,msg,type){
      const el=document.getElementById(id);
      el.textContent=msg;el.className='message '+type;el.style.display='block';
    }

    function validateOTP(i){i.value=i.value.replace(/[^0-9]/g,'');}
    function setLoading(btn,state){btn.disabled=state;btn.textContent=state?'Sending OTP...':'Send OTP to Email';}
    function generateOTP(){return Math.floor(100000+Math.random()*900000).toString();}

    async function sendOTP(){
      const u=document.getElementById('signupUsername').value.trim(),
            e=document.getElementById('signupEmail').value.trim(),
            btn=document.getElementById('sendOtpBtn');
      if(!u||!e)return showMessage('signupMessage','Please fill username & email','error');
      if(u.toLowerCase()===ADMIN_USERNAME.toLowerCase())
        return showMessage('signupMessage','This username is reserved.','error');

      currentEmail=e;currentUsername=u;currentOTP=generateOTP();
      setLoading(btn,true);
      try{
        const params={to_email:e,otp_code:currentOTP,user_name:u,website_name:'Project Ebooks'};
        const r=await emailjs.send("service_039rifr","template_c7tcljk",params);
        if(r.status===200){
          document.getElementById('otpSection').style.display='block';
          document.getElementById('sendOtpBtn').style.display='none';
          showMessage('signupMessage','‚úÖ OTP sent to your email!','success');
        }
      }catch(err){
        document.getElementById('otpSection').style.display='block';
        document.getElementById('sendOtpBtn').style.display='none';
        showMessage('signupMessage',`‚úÖ OTP: ${currentOTP} (use this if email failed)`,'success');
        console.error('EmailJS Error:',err);
      }finally{setLoading(btn,false);}
    }

    function verifyOTP(){
      const code=document.getElementById('otpCode').value.trim();
      if(code.length!==6)return showMessage('signupMessage','Enter 6-digit OTP','error');
      if(code===currentOTP){
        const users=JSON.parse(localStorage.getItem('users')||'{}');
        users[currentUsername]={email:currentEmail,
                                password:document.getElementById('signupPassword').value,
                                verified:true,isAdmin:false};
        localStorage.setItem('users',JSON.stringify(users));
        showMessage('signupMessage','‚úÖ OTP verified!','success');
        setTimeout(()=>window.location.href='dashboard.html',1500);
      }else showMessage('signupMessage','‚ùå Invalid OTP!','error');
    }

    function loginUser(){
      const u=document.getElementById('loginUsername').value.trim(),
            p=document.getElementById('loginPassword').value.trim();
      if(u===ADMIN_USERNAME&&p===ADMIN_PASSWORD){
        localStorage.setItem('currentUser',u);
        localStorage.setItem('isAdmin','true');
        showMessage('loginMessage','üîì Admin login successful!','success');
        document.getElementById('adminIndicator').style.display='block';
        return setTimeout(()=>window.location.href='dashboard.html',1000);
      }
      const users=JSON.parse(localStorage.getItem('users')||'{}');
      if(users[u]&&users[u].password===p){
        localStorage.setItem('currentUser',u);
        localStorage.setItem('isAdmin','false');
        showMessage('loginMessage','‚úÖ Login successful!','success');
        setTimeout(()=>window.location.href='dashboard.html',1000);
      }else showMessage('loginMessage','‚ùå Invalid username or password!','error');
    }

    function resendOTP(){
      currentOTP=generateOTP();
      sendOTP();
      showMessage('signupMessage','üìß New OTP sent!','success');
    }

    function checkAdminStatus(){
      if(localStorage.getItem('isAdmin')==='true')
        document.getElementById('adminIndicator').style.display='block';
    }
    window.onload=checkAdminStatus;
  </script>
</body>
</html>